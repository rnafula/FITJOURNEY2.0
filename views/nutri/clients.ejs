<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>My Clients - FitJourney</title>
  <link rel="stylesheet" href="nutri.css">
 <!--  <link rel="stylesheet" href="header.css"> -->
  <style>
    
    .client-list {
      margin: 20px;
    }
    .client-card {
      background: #fff;
      padding: 15px;
      margin-bottom: 15px;
      border-radius: 10px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    }
    .client-card h3 {
      margin: 0;
      color: #076396;
    }
    .client-card p {
      margin: 4px 0;
      color: #333;
    }
    .actions {
      margin-top: 10px;
    }
    .actions form {
      display: inline;
    }
    .actions button {
      padding: 6px 12px;
      margin-right: 5px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
    }
    .approve-btn {
      background: #28a745;
      color: #fff;
    }
    .reject-btn {
      background: #dc3545;
      color: #fff;
    }
    #overlay{
       display:none;
      position:fixed;
      top:0;
      left:0;
      width: 100%;
      height:100%;
      background: rgba(0,0,0,0.5);
      z-index:900;
    }
    #popup{
       display:none;
    position: fixed;
    top:20%;
    left:50%;
    transform: translateX(-50%);
    background:#fff;
    padding:20px;
    border-radius: 12px;
    box-shadow: 0 4px 8px rgba(0,0,0,0.2);
    z-index:1000;
    width:300px;
    }
    #popup form{
       display: flex;
      flex-direction: column;
      gap:10px;

    }
  </style>
</head>
<body>
      <%- include("../_header.ejs") %>
  <div class="dashboard">
  <!-- overlay -->
 <div class="overlay"></div>
    <!-- Main Content -->
    <main class="content">
      <header>
        <h1>My Clients</h1>
      </header>

      <section class="client-list">
        <% if (clients.length === 0) { %>
          <p>No client requests yet.</p>
        <% } else { %>
          <% clients.forEach(reqs => { %>
            <div class="client-card">
              <h3><%= reqs.username %></h3>
              <p><strong>Goal:</strong> <%= reqs.goal %></p>
              <p><strong>Notes:</strong> <%= reqs.notes || "None" %></p>
              <p><strong>Plan Type:</strong> <%= reqs.plan_type %></p>
              <p><strong>Status:</strong> <%= reqs.status %></p>

              <div class="actions">
                <% if (reqs.status === "pending") { %>
                 
                  <form action="/requests/<%= reqs.id %>/approve" method="POST">
                    <button type="submit" class="approve-btn">Approve</button>
                    <button type="submit"  id="rejectButton" class="reject-btn">Reject</button>
                  </form>
                <% } else if(reqs.status === "paid") { %>
                  <form action="/requests/<%= reqs.id %>/reject" method="POST">
                    <button type="submit" class="approve-btn">Assign plan</button>
                  </form>
                <% } else if(reqs.status === "completed"){ %>
                  <form action="/requests/<%= reqs.id %>/reject" method="POST">
                    <button type="submit" class="approve-btn">View Client</button>
                  </form>
                <% } else { %>
                  <p><em>Already <%= reqs.status %></em></p>
                <% } %>
              </div>
            </div>
             <div id="popup">
      <form action="/requests/<%= reqs.id %>/reject" method="POST" id="reject" style="display:none; ">
        <textarea name="rejection_message" class="rejection" placeholder="Explain why you're rejecting this request (required)" required></textarea>
        <button type="submit"  class="reject-btn">Submit</button>
      </form>
  </div>
          <% }) %>
        <% } %>
      </section>
    </main>
    
  </div>
 
  <script>
    const overlay =document.getElementById(".overlay")
    const popup =document.getElementById("popup")
   const reject = document.getElementById("reject")
   const rejectButton =document.getElementById("rejectButton")

    document.querySelectorAll('.reject-btn').forEach(btn => {
      btn.addEventListener('click', () => {
      popup.style.display = 'block';
      overlay.style.display = 'block';
      });
    });
    rejectButton.addEventListener("click", () =>{
      overlay.style.display ="block"
      reject.style.display ="block"
      popup.style.display ="block"
    })
    reject.addEventListener("submit", ()=>{
      overlay.style.display ="none"
        reject.style.display ="block"
         popup.style.display ="block"
    
    })
  </script>
</body>
</html>
